
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
{% extends 'base.html' %}


{% block content %}

{% set is_contact = [] %}

{% for conv in Conversions %}
    {% if conv[0] == 1 and conv[2] is not none %}
        {{ is_contact.append(conv[2]) }}
    {% elif conv[2] == 1 and conv[0] is not none %}
        {{ is_contact.append(conv[0]) }}
    {% endif %}
{% endfor %}


<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addContactModal">
  Ajouter un contact
</button>



<div class="modal fade" id="addContactModal" tabindex="-1" role="dialog" aria-labelledby="addContactModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addContactModalLabel">Rechercher un nouvel utilisateur</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <!-- Barre de recherche -->
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Rechercher un utilisateur..." class="form-control mb-3">

        <!-- Tableau des utilisateurs caché dans le modal -->
        <table id="userTable" class="table table-striped">
          <thead>
            <tr>
              <th>Username</th>
              <th>E-mail</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for user in Users %}
            <!-- Le 1 a remplacer par l'id de l'utilisateur connecter -->
                {% if user[0] != 1 %}
                    {% if user[0] not in is_contact %}
                        <tr>
                          <td>{{ user[0] }}</td>
                          <td>{{ user[1] }}</td>
                          <td>
                            <form action="{{ url_for('contact.add_contact') }}" method="post">
                              <input type="hidden" name="user1" value="1"> <!-- A remplacer plus tard par le vrai user connecté -->
                              <input type="hidden" name="user2" value="{{ user[0] }}">
                              <input type="submit" value="Ajouter" class="btn btn-success btn-sm">
                            </form>
                          </td>
                        </tr>
                    {% endif %}
                {% endif %}
            {% endfor %}
          </tbody>
        </table>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
      </div>

    </div>
  </div>
</div>

<h3> Liste des contacts</h3>
<!-- Liste des contacts -->
<table>
    <thead>
        <tr>
            <th>Username</th>
        </tr>
    </thead>
    <tbody>
    {% for user in Users %}
        {% if user[0] in is_contact %}
            <tr>
                <td>
                    <form action="#" method="post">
                        <!-- remplacer par l'utilisateur co le -->
                        <input type="hidden" name="user1" value="1">
                        <input type="hidden" name="user2" value="{{user[0]}}">
                        <input type="submit" value="{{ user[1] }}">
                    </form>
                </td>
            </tr>
        {% endif %}
    {% endfor %}
    </tbody>
</table>


<script>
function filterTable() {
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("searchInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("userTable");
  tr = table.getElementsByTagName("tr");

  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0]; // on cherche sur Username
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}
</script>
{% endblock %}